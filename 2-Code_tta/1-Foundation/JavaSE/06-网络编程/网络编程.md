# 🌐 Java 网络编程

## 一、网络编程概述

### 1.1 基本概念

> 🌍 **网络编程** = 定位主机 + 数据传输

- **IP地址**：唯一标识网络中的设备
- **端口号**：标识设备中的应用程序（0~65535）
- **协议**：通信规则（TCP/IP模型）

### 1.2 网络通信模型

| OSI模型（理论） | TCP/IP模型（实际） | 常见协议 |
|----------------|-------------------|----------|
| 应用层          | 应用层             | HTTP, FTP, DNS |
| 表示层          |                   |          |
| 会话层          |                   |          |
| 传输层          | 传输层             | TCP, UDP |
| 网络层          | 网络层             | IP, ICMP |
| 数据链路层       | 链路层             | Ethernet |
| 物理层          |                   |          |

---

## 二、InetAddress 类

### 2.1 IP地址表示

```java
import java.net.InetAddress;

public class InetAddressDemo {
    public static void main(String[] args) throws Exception {
        // 获取本地IP
        InetAddress local = InetAddress.getLocalHost();
        System.out.println("本地IP: " + local.getHostAddress());
        
        // 通过域名获取IP
        InetAddress baidu = InetAddress.getByName("www.baidu.com");
        System.out.println("百度IP: " + baidu.getHostAddress());
    }
}
```

### 2.2 端口与Socket

```java
import java.net.InetSocketAddress;

public class SocketAddressDemo {
    public static void main(String[] args) {
        InetSocketAddress socketAddress = 
            new InetSocketAddress("localhost", 8080);
        System.out.println("主机名: " + socketAddress.getHostName());
        System.out.println("端口号: " + socketAddress.getPort());
    }
}
```

---

## 三、TCP编程

### 3.1 TCP vs UDP

| 特性 | TCP | UDP |
|------|-----|-----|
| 连接性 | 面向连接 | 无连接 |
| 可靠性 | 可靠传输 | 不可靠 |
| 速度 | 慢 | 快 |
| 数据量 | 无限制 | ≤64KB |
| 应用 | 文件传输、网页浏览 | 视频会议、DNS |

### 3.2 TCP客户端示例

```java
// TCP客户端
public class TCPClient {
    public static void main(String[] args) throws IOException {
        Socket socket = new Socket("127.0.0.1", 8888);
        OutputStream os = socket.getOutputStream();
        os.write("Hello Server!".getBytes());
        os.close();
        socket.close();
    }
}
```

### 3.3 TCP服务端示例

```java
// TCP服务端
public class TCPServer {
    public static void main(String[] args) throws IOException {
        ServerSocket serverSocket = new ServerSocket(8888);
        Socket clientSocket = serverSocket.accept(); // 阻塞等待连接
        
        InputStream is = clientSocket.getInputStream();
        byte[] buffer = new byte[1024];
        int len = is.read(buffer);
        System.out.println("收到: " + new String(buffer, 0, len));
        
        is.close();
        clientSocket.close();
        serverSocket.close();
    }
}
```

### 3.4 文件传输示例

```java
// 客户端发送文件
public class FileClient {
    public static void main(String[] args) throws Exception {
        Socket socket = new Socket("127.0.0.1", 9090);
        OutputStream os = socket.getOutputStream();
        FileInputStream fis = new FileInputStream("test.jpg");
        
        byte[] buffer = new byte[1024];
        int len;
        while ((len = fis.read(buffer)) != -1) {
            os.write(buffer, 0, len);
        }
        
        // 通知服务器传输完成
        socket.shutdownOutput();
        
        // 等待服务器响应
        InputStream is = socket.getInputStream();
        // 读取响应信息...
        
        fis.close();
        os.close();
        socket.close();
    }
}
```

---

## 四、UDP编程

### 4.1 UDP发送端

```java
public class UDPSender {
    public static void main(String[] args) throws Exception {
        DatagramSocket socket = new DatagramSocket();
        
        String msg = "Hello UDP!";
        byte[] data = msg.getBytes();
        
        InetAddress address = InetAddress.getByName("127.0.0.1");
        DatagramPacket packet = new DatagramPacket(
            data, 0, data.length, address, 9090);
        
        socket.send(packet);
        socket.close();
    }
}
```

### 4.2 UDP接收端

```java
public class UDPReceiver {
    public static void main(String[] args) throws Exception {
        DatagramSocket socket = new DatagramSocket(9090);
        
        byte[] buffer = new byte[1024];
        DatagramPacket packet = new DatagramPacket(buffer, 0, buffer.length);
        
        socket.receive(packet); // 阻塞接收
        System.out.println("收到: " + new String(
            packet.getData(), 0, packet.getLength()));
        
        socket.close();
    }
}
```

### 4.3 UDP聊天程序

```java
// 发送线程
class TalkSend implements Runnable {
    private DatagramSocket socket;
    private String targetIP;
    private int targetPort;

    public void run() {
        BufferedReader reader = new BufferedReader(
            new InputStreamReader(System.in));
        while (true) {
            try {
                String msg = reader.readLine();
                byte[] data = msg.getBytes();
                DatagramPacket packet = new DatagramPacket(
                    data, 0, data.length, 
                    new InetSocketAddress(targetIP, targetPort));
                socket.send(packet);
                if ("bye".equals(msg)) break;
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
        socket.close();
    }
}
```

---

## 五、URL编程

### 5.1 URL解析

```java
public class URLDemo {
    public static void main(String[] args) throws Exception {
        URL url = new URL("https://www.baidu.com:8080/search?q=java#results");
        
        System.out.println("协议: " + url.getProtocol());
        System.out.println("主机: " + url.getHost());
        System.out.println("端口: " + url.getPort());
        System.out.println("路径: " + url.getPath());
        System.out.println("查询: " + url.getQuery());
        System.out.println("锚点: " + url.getRef());
    }
}
```

### 5.2 网络资源下载

```java
public class URLDownload {
    public static void main(String[] args) throws Exception {
        URL url = new URL("https://example.com/file.jpg");
        HttpURLConnection connection = (HttpURLConnection) url.openConnection();
        
        try (InputStream is = connection.getInputStream();
             FileOutputStream fos = new FileOutputStream("downloaded.jpg")) {
            
            byte[] buffer = new byte[1024];
            int len;
            while ((len = is.read(buffer)) != -1) {
                fos.write(buffer, 0, len);
            }
        }
        connection.disconnect();
    }
}
```

---

## 六、网络编程总结

### 6.1 核心类对比

| 类名 | 用途 | 特点 |
|------|------|------|
| `InetAddress` | IP地址表示 | 无构造器，静态方法获取实例 |
| `Socket` | TCP客户端 | 需要指定服务器地址和端口 |
| `ServerSocket` | TCP服务端 | 监听端口，接受连接 |
| `DatagramSocket` | UDP通信 | 无连接，数据包传输 |
| `URL` | 统一资源定位 | 解析和访问网络资源 |

### 6.2 编程模式对比

| 模式 | 优点 | 缺点 | 适用场景 |
|------|------|------|----------|
| TCP | 可靠、有序 | 速度慢、开销大 | 文件传输、网页访问 |
| UDP | 速度快、开销小 | 不可靠、无序 | 视频会议、实时游戏 |
| URL | 简单易用 | 功能有限 | 资源访问、简单下载 |

### 6.3 注意事项

1. **异常处理**：网络操作必须处理 `IOException`
2. **资源释放**：确保关闭Socket和流
3. **编码问题**：注意字符编码转换
4. **超时设置**：合理设置连接和读取超时
5. **线程安全**：多线程环境下注意资源共享

---

> 🚀 **网络编程是Java的核心能力之一**，掌握TCP/UDP编程、理解网络协议栈、熟悉常见的网络编程模式，是成为高级Java开发者的必备技能。从简单的Socket通信到复杂的网络框架，都需要扎实的网络编程基础。