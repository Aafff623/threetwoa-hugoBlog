# ğŸ§µ Java å¤šçº¿ç¨‹ç¼–ç¨‹

## ä¸€ã€çº¿ç¨‹ç®€ä»‹

### 1.1 ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ

> çº¿ç¨‹æ˜¯ç¨‹åºä¸­çš„æ‰§è¡Œè·¯å¾„ï¼Œæ˜¯ CPU è°ƒåº¦å’Œæ‰§è¡Œçš„æœ€å°å•ä½ã€‚

- **ç¨‹åº**ï¼šé™æ€çš„ä»£ç é›†åˆ
- **è¿›ç¨‹**ï¼šæ‰§è¡Œç¨‹åºçš„ä¸€æ¬¡è¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿèµ„æºåˆ†é…çš„å•ä½
- **çº¿ç¨‹**ï¼šè¿›ç¨‹ä¸­çš„æ‰§è¡Œå•å…ƒï¼Œæ˜¯ CPU è°ƒåº¦çš„å•ä½

### 1.2 å¤šçº¿ç¨‹çš„åº”ç”¨åœºæ™¯

- åŒæ—¶ä¸‹è½½å¤šä¸ªæ–‡ä»¶
- åå°è¿è¡Œå®šæ—¶ä»»åŠ¡
- æ¸¸æˆä¸­çš„éŸ³ç”»åŒæ­¥
- ç”¨æˆ·ç•Œé¢å“åº”ä¸åå°è®¡ç®—

---

## äºŒã€çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼

### 2.1 ç»§æ‰¿ Thread ç±»

```java
public class MyThread extends Thread {
    @Override
    public void run() {
        for (int i = 0; i < 10; i++) {
            System.out.println("æˆ‘åœ¨å†™ä»£ç --" + i);
        }
    }

    public static void main(String[] args) {
        MyThread t1 = new MyThread();
        t1.start(); // å¯åŠ¨çº¿ç¨‹
    }
}
```

### 2.2 å®ç° Runnable æ¥å£ï¼ˆæ¨èï¼‰

```java
public class MyRunnable implements Runnable {
    @Override
    public void run() {
        for (int i = 0; i < 10; i++) {
            System.out.println("æˆ‘åœ¨æ‘¸é±¼--" + i);
        }
    }

    public static void main(String[] args) {
        Thread t = new Thread(new MyRunnable());
        t.start();
    }
}
```

### 2.3 å®ç° Callable æ¥å£ï¼ˆäº†è§£ï¼‰

```java
public class MyCallable implements Callable<String> {
    @Override
    public String call() throws Exception {
        return "Callable è¿”å›å€¼";
    }

    public static void main(String[] args) throws Exception {
        ExecutorService ser = Executors.newFixedThreadPool(1);
        Future<String> result = ser.submit(new MyCallable());
        System.out.println(result.get());
        ser.shutdown();
    }
}
```

### 2.4 Lambda è¡¨è¾¾å¼ç®€åŒ–å†™æ³•

```java
new Thread(() -> {
    for (int i = 0; i < 10; i++) {
        System.out.println("Lambda çº¿ç¨‹--" + i);
    }
}).start();
```

---

## ä¸‰ã€çº¿ç¨‹çŠ¶æ€ä¸ç”Ÿå‘½å‘¨æœŸ

```mermaid
graph TD
A[æ–°å»º NEW] --> B[å°±ç»ª RUNNABLE]
B --> C[è¿è¡Œ RUNNING]
C --> B
C --> D[é˜»å¡ BLOCKED]
D --> B
C --> E[æ­»äº¡ TERMINATED]
```

### 3.1 å¸¸ç”¨çº¿ç¨‹æ–¹æ³•

| æ–¹æ³•                     | è¯´æ˜                         |
| ------------------------ | ---------------------------- |
| `sleep(long millis)`     | çº¿ç¨‹ä¼‘çœ ï¼Œä¸é‡Šæ”¾é”             |
| `join()`                 | ç­‰å¾…è¯¥çº¿ç¨‹æ‰§è¡Œå®Œæ¯•             |
| `yield()`                | ç¤¼è®©ï¼Œè®©å‡º CPU æ—¶é—´ç‰‡          |
| `setPriority(int)`       | è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§ï¼ˆ1-10ï¼‰         |
| `interrupt()`            | ä¸­æ–­çº¿ç¨‹ï¼ˆä¸å»ºè®®ç›´æ¥ä½¿ç”¨ï¼‰       |

---

## å››ã€çº¿ç¨‹åŒæ­¥ä¸é”æœºåˆ¶

### 4.1 åŒæ­¥ä»£ç å—

```java
synchronized (obj) {
    // éœ€è¦åŒæ­¥çš„ä»£ç 
}
```

### 4.2 åŒæ­¥æ–¹æ³•

```java
public synchronized void method() {
    // åŒæ­¥æ–¹æ³•ä½“
}
```

### 4.3 Lock é”ï¼ˆæ¨èï¼‰

```java
private final ReentrantLock lock = new ReentrantLock();

public void method() {
    lock.lock();
    try {
        // çº¿ç¨‹å®‰å…¨ä»£ç 
    } finally {
        lock.unlock(); // å¿…é¡»æ‰‹åŠ¨é‡Šæ”¾é”
    }
}
```

### 4.4 synchronized vs Lock

| ç‰¹æ€§         | synchronized | Lock          |
| ------------ | ------------ | ------------- |
| é”è·å–æ–¹å¼     | è‡ªåŠ¨         | æ‰‹åŠ¨          |
| é”é‡Šæ”¾æ–¹å¼     | è‡ªåŠ¨         | æ‰‹åŠ¨          |
| çµæ´»æ€§        | ä½           | é«˜            |
| æ€§èƒ½          | è¾ƒä½         | è¾ƒé«˜          |

---

## äº”ã€çº¿ç¨‹é€šä¿¡ï¼šç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹

### 5.1 ä½¿ç”¨ wait() å’Œ notify()

```java
class Buffer {
    private int value;
    private boolean isEmpty = true;

    public synchronized void put(int value) {
        while (!isEmpty) {
            wait(); // ç­‰å¾…æ¶ˆè´¹è€…å–èµ°
        }
        this.value = value;
        isEmpty = false;
        notify(); // é€šçŸ¥æ¶ˆè´¹è€…
    }

    public synchronized int take() {
        while (isEmpty) {
            wait(); // ç­‰å¾…ç”Ÿäº§è€…ç”Ÿäº§
        }
        isEmpty = true;
        notify(); // é€šçŸ¥ç”Ÿäº§è€…
        return value;
    }
}
```

### 5.2 ä½¿ç”¨ BlockingQueueï¼ˆæ¨èï¼‰

```java
BlockingQueue<Integer> queue = new ArrayBlockingQueue<>(10);

// ç”Ÿäº§è€…
queue.put(1);

// æ¶ˆè´¹è€…
int value = queue.take();
```

---

## å…­ã€çº¿ç¨‹æ± ï¼ˆThreadPoolï¼‰

### 6.1 åˆ›å»ºçº¿ç¨‹æ± 

```java
ExecutorService pool = Executors.newFixedThreadPool(5);

pool.execute(() -> {
    System.out.println("çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œ");
});

pool.shutdown();
```

### 6.2 çº¿ç¨‹æ± å‚æ•°è¯´æ˜

| å‚æ•°                | è¯´æ˜                 |
| ------------------- | -------------------- |
| corePoolSize        | æ ¸å¿ƒçº¿ç¨‹æ•°             |
| maximumPoolSize     | æœ€å¤§çº¿ç¨‹æ•°             |
| keepAliveTime       | ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´         |
| workQueue           | ä»»åŠ¡é˜Ÿåˆ—               |
| threadFactory       | çº¿ç¨‹å·¥å‚               |
| handler             | æ‹’ç»ç­–ç•¥               |

---

## ä¸ƒã€æ­»é”ä¸é¿å…

### 7.1 æ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶

1. äº’æ–¥æ¡ä»¶
2. è¯·æ±‚ä¸ä¿æŒæ¡ä»¶
3. ä¸å‰¥å¤ºæ¡ä»¶
4. å¾ªç¯ç­‰å¾…æ¡ä»¶

### 7.2 é¿å…æ­»é”çš„æ–¹æ³•

- é¿å…åµŒå¥—é”
- ä½¿ç”¨å®šæ—¶é” `tryLock()`
- æŒ‰é¡ºåºè·å–é”

---

## å…«ã€æ€»ç»“ä¸æœ€ä½³å®è·µ

- âœ… ä¼˜å…ˆä½¿ç”¨ `Runnable` å’Œ `Lambda`
- âœ… ä½¿ç”¨ `Lock` æ›¿ä»£ `synchronized`
- âœ… ä½¿ç”¨çº¿ç¨‹æ± ç®¡ç†çº¿ç¨‹
- âœ… ä½¿ç”¨ `BlockingQueue` å®ç°çº¿ç¨‹é€šä¿¡
- âŒ é¿å…ä½¿ç”¨ `stop()`ã€`suspend()` ç­‰è¿‡æ—¶æ–¹æ³•
- âŒ é¿å…æ­»é”å’Œèµ„æºç«äº‰

---

> ğŸ¯ å¤šçº¿ç¨‹æ˜¯ Java ç¼–ç¨‹ä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼ŒæŒæ¡å¥½çº¿ç¨‹çš„ä½¿ç”¨å’ŒåŒæ­¥æœºåˆ¶ï¼Œèƒ½æ˜¾è‘—æå‡ç¨‹åºæ€§èƒ½å’Œå“åº”èƒ½åŠ›ã€‚