
# ğŸ” MySQL DQL æ•°æ®æŸ¥è¯¢è¯­è¨€

> ğŸ“– **æœ¬æ–‡æ¡£å†…å®¹åŸºäº**ï¼š[Bç«™MySQLè§†é¢‘æ•™ç¨‹(0-57P)](https://www.bilibili.com/video/BV1Kr4y1i7ru/?spm_id_from=333.337.search-card.all.click&vd_source=7d8ded408b70aba5029782726fc72622) å’Œ [CSDN MySQLåŸºç¡€ç¬”è®°](https://blog.csdn.net/wohuishidalao/article/details/133971522)

## ğŸ¯ 1. åŸºç¡€æŸ¥è¯¢è¯­æ³•

### 1.1 åŸºæœ¬æŸ¥è¯¢ç»“æ„
```sql
-- æŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼ˆå®é™…å¼€å‘ä¸­ä¸å»ºè®®ä½¿ç”¨*ï¼‰
SELECT * FROM table_name;

-- æŸ¥è¯¢æŒ‡å®šå­—æ®µ
SELECT column1, column2 FROM table_name;

-- ä½¿ç”¨è¡¨åå‰ç¼€
SELECT students.name, students.age FROM students;
```

### 1.2 åˆ«åä¸å»é‡
```sql
-- å­—æ®µåˆ«åï¼ˆAS å¯çœç•¥ï¼‰
SELECT name AS å§“å, age AS å¹´é¾„ FROM students;
SELECT name å§“å, age å¹´é¾„ FROM students;

-- è¡¨åˆ«å
SELECT s.name, s.age FROM students s;

-- å»é‡æŸ¥è¯¢
SELECT DISTINCT gender FROM students;
SELECT DISTINCT age, gender FROM students;  -- å¤šå­—æ®µç»„åˆå»é‡
```

## ğŸ¯ 2. æ¡ä»¶æŸ¥è¯¢ï¼ˆWHEREï¼‰

### 2.1 æ¯”è¾ƒè¿ç®—ç¬¦
```sql
-- åŸºæœ¬æ¯”è¾ƒ
SELECT * FROM students WHERE age > 20;
SELECT * FROM students WHERE age >= 18;
SELECT * FROM students WHERE age = 20;
SELECT * FROM students WHERE age <> 20;    -- ä¸ç­‰äº
SELECT * FROM students WHERE age != 20;    -- ä¸ç­‰äº
```

### 2.2 é€»è¾‘è¿ç®—ç¬¦
```sql
-- AND è¿ç®—ç¬¦
SELECT * FROM students WHERE age > 18 AND gender = 'å¥³';

-- OR è¿ç®—ç¬¦  
SELECT * FROM students WHERE age < 18 OR age > 22;

-- NOT è¿ç®—ç¬¦
SELECT * FROM students WHERE NOT gender = 'ç”·';
SELECT * FROM students WHERE NOT age <= 20;

-- ç»„åˆä½¿ç”¨
SELECT * FROM students 
WHERE (age > 18 AND gender = 'å¥³') OR (age < 20 AND gender = 'ç”·');
```

### 2.3 èŒƒå›´æŸ¥è¯¢
```sql
-- BETWEEN ANDï¼ˆåŒ…å«è¾¹ç•Œå€¼ï¼‰
SELECT * FROM students WHERE age BETWEEN 18 AND 22;

-- IN è¿ç®—ç¬¦
SELECT * FROM students WHERE age IN (18, 20, 22);
SELECT * FROM students WHERE name IN ('å¼ ä¸‰', 'æå››', 'ç‹äº”');

-- NOT IN
SELECT * FROM students WHERE age NOT IN (18, 20);
```

### 2.4 æ¨¡ç³ŠæŸ¥è¯¢ï¼ˆLIKEï¼‰
```sql
-- % é€šé…ç¬¦ï¼šåŒ¹é…ä»»æ„å¤šä¸ªå­—ç¬¦
SELECT * FROM students WHERE name LIKE 'å¼ %';   -- å¼ å¼€å¤´
SELECT * FROM students WHERE name LIKE '%æ˜%';  -- åŒ…å«æ˜
SELECT * FROM students WHERE name LIKE '%æ';    -- æç»“å°¾

-- _ é€šé…ç¬¦ï¼šåŒ¹é…å•ä¸ªå­—ç¬¦
SELECT * FROM students WHERE name LIKE 'æ_';    -- æå¼€å¤´ï¼Œä¸¤ä¸ªå­—
SELECT * FROM students WHERE name LIKE '_å°_';   -- ä¸­é—´ä¸ºå°ï¼Œä¸‰ä¸ªå­—

-- è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
SELECT * FROM students WHERE name LIKE '%\_%' ESCAPE '\';  -- åŒ…å«ä¸‹åˆ’çº¿
```

### 2.5 ç©ºå€¼æŸ¥è¯¢
```sql
-- æŸ¥è¯¢ç©ºå€¼
SELECT * FROM students WHERE email IS NULL;
SELECT * FROM students WHERE email IS NULL OR email = '';

-- æŸ¥è¯¢éç©ºå€¼
SELECT * FROM students WHERE email IS NOT NULL;
SELECT * FROM students WHERE email IS NOT NULL AND email != '';
```

## ğŸ¯ 3. æ’åºä¸åˆ†é¡µ

### 3.1 æ’åºæŸ¥è¯¢ï¼ˆORDER BYï¼‰
```sql
-- å•å­—æ®µæ’åº
SELECT * FROM students ORDER BY age DESC;  -- é™åº
SELECT * FROM students ORDER BY age ASC;   -- å‡åºï¼ˆé»˜è®¤ï¼‰

-- å¤šå­—æ®µæ’åº
SELECT * FROM students 
ORDER BY gender ASC, age DESC;  -- å…ˆæŒ‰æ€§åˆ«å‡åºï¼ŒåŒæ€§åˆ«æŒ‰å¹´é¾„é™åº

-- ç»“åˆè¡¨è¾¾å¼æ’åº
SELECT *, (score1 + score2) AS total_score 
FROM students 
ORDER BY total_score DESC;

-- NULL å€¼æ’åºå¤„ç†
SELECT * FROM students 
ORDER BY CASE WHEN email IS NULL THEN 1 ELSE 0 END, email;
```

### 3.2 åˆ†é¡µæŸ¥è¯¢ï¼ˆLIMITï¼‰
```sql
-- åŸºæœ¬åˆ†é¡µ
SELECT * FROM students LIMIT 5;                    -- å‰5æ¡
SELECT * FROM students LIMIT 0, 5;                 -- ä»0å¼€å§‹å–5æ¡
SELECT * FROM students LIMIT 5 OFFSET 0;           -- MySQL 8.0+ è¯­æ³•

-- åˆ†é¡µå…¬å¼ï¼šLIMIT (é¡µç -1)*æ¯é¡µæ•°é‡, æ¯é¡µæ•°é‡
SELECT * FROM students LIMIT 0, 10;                -- ç¬¬1é¡µ
SELECT * FROM students LIMIT 10, 10;               -- ç¬¬2é¡µ
SELECT * FROM students LIMIT 20, 10;               -- ç¬¬3é¡µ

-- å¸¦æ¡ä»¶çš„åˆ†é¡µ
SELECT * FROM students 
WHERE age > 18 
ORDER BY age DESC 
LIMIT 0, 5;
```

## ğŸ¯ 4. èšåˆå‡½æ•°

### 4.1 å¸¸ç”¨èšåˆå‡½æ•°
```sql
-- è®¡æ•°å‡½æ•°
SELECT COUNT(*) FROM students;                     -- æ€»è®°å½•æ•°
SELECT COUNT(email) FROM students;                 -- éç©ºé‚®ç®±æ•°
SELECT COUNT(DISTINCT gender) FROM students;       -- ä¸åŒæ€§åˆ«æ•°é‡

-- æå€¼å‡½æ•°
SELECT MAX(age) FROM students;                     -- æœ€å¤§å¹´é¾„
SELECT MIN(age) FROM students;                     -- æœ€å°å¹´é¾„

-- æ±‚å’Œä¸å¹³å‡
SELECT SUM(age) FROM students;                     -- å¹´é¾„æ€»å’Œ
SELECT AVG(age) FROM students;                     -- å¹³å‡å¹´é¾„
SELECT ROUND(AVG(age), 2) FROM students;           -- å¹³å‡å¹´é¾„ï¼ˆä¿ç•™2ä½å°æ•°ï¼‰
```

### 4.2 èšåˆå‡½æ•°ç»„åˆä½¿ç”¨
```sql
-- å¤šèšåˆå‡½æ•°ç»„åˆ
SELECT 
    COUNT(*) AS æ€»äººæ•°,
    AVG(age) AS å¹³å‡å¹´é¾„,
    MAX(age) AS æœ€å¤§å¹´é¾„,
    MIN(age) AS æœ€å°å¹´é¾„
FROM students;

-- å¸¦æ¡ä»¶çš„èšåˆ
SELECT 
    COUNT(*) AS ç”·ç”Ÿäººæ•°,
    AVG(age) AS ç”·ç”Ÿå¹³å‡å¹´é¾„
FROM students
WHERE gender = 'ç”·';
```

## ğŸ¯ 5. åˆ†ç»„æŸ¥è¯¢ï¼ˆGROUP BYï¼‰

### 5.1 åŸºæœ¬åˆ†ç»„æŸ¥è¯¢
```sql
-- å•å­—æ®µåˆ†ç»„
SELECT gender, COUNT(*) 
FROM students 
GROUP BY gender;

-- å¤šå­—æ®µåˆ†ç»„
SELECT gender, age, COUNT(*)
FROM students
GROUP BY gender, age;

-- åˆ†ç»„åæ’åº
SELECT gender, COUNT(*) AS äººæ•°
FROM students
GROUP BY gender
ORDER BY äººæ•° DESC;
```

### 5.2 HAVING å­å¥
```sql
-- HAVING ç­›é€‰åˆ†ç»„ç»“æœ
SELECT gender, COUNT(*) AS äººæ•°
FROM students
GROUP BY gender
HAVING COUNT(*) > 2;

SELECT gender, AVG(age) AS å¹³å‡å¹´é¾„
FROM students
GROUP BY gender
HAVING AVG(age) > 20;

-- HAVING ä¸ WHERE çš„åŒºåˆ«
SELECT gender, AVG(age) AS å¹³å‡å¹´é¾„
FROM students
WHERE age > 18          -- å…ˆè¿‡æ»¤è¡Œ
GROUP BY gender
HAVING AVG(age) > 20;   -- å†è¿‡æ»¤ç»„
```

## ğŸ¯ 6. æ‰§è¡Œé¡ºåºè¯¦è§£

### 6.1 å®Œæ•´æŸ¥è¯¢è¯­å¥æ‰§è¡Œé¡ºåº
```mermaid
graph LR
A[FROM] --> B[WHERE] --> C[GROUP BY] --> D[HAVING] --> E[SELECT] --> F[ORDER BY] --> G[LIMIT]
```

### 6.2 æ‰§è¡Œé¡ºåºè¯´æ˜
1. **FROM**ï¼šç¡®å®šæ•°æ®æ¥æºçš„è¡¨
2. **WHERE**ï¼šè¿‡æ»¤è¡Œæ•°æ®
3. **GROUP BY**ï¼šå¯¹æ•°æ®è¿›è¡Œåˆ†ç»„
4. **HAVING**ï¼šè¿‡æ»¤åˆ†ç»„ç»“æœ
5. **SELECT**ï¼šé€‰æ‹©æ˜¾ç¤ºçš„å­—æ®µ
6. **ORDER BY**ï¼šå¯¹ç»“æœè¿›è¡Œæ’åº
7. **LIMIT**ï¼šé™åˆ¶è¿”å›çš„è¡Œæ•°

> ğŸ’¡ **è®°å¿†æŠ€å·§**ï¼šä»å“ªæ¥ â†’ è¿‡æ»¤è¡Œ â†’ åˆ†ç»„ â†’ è¿‡æ»¤ç»„ â†’ é€‰æ‹© â†’ æ’åº â†’ åˆ†é¡µ

## ğŸ¯ 7. ç»¼åˆå®æˆ˜ç¤ºä¾‹

### 7.1 å¤æ‚æŸ¥è¯¢æ¡ˆä¾‹
```sql
-- æ¡ˆä¾‹1ï¼šæŸ¥è¯¢å„æ€§åˆ«18å²ä»¥ä¸Šçš„å­¦ç”Ÿäººæ•°å’Œå¹³å‡å¹´é¾„
SELECT 
    gender AS æ€§åˆ«,
    COUNT(*) AS äººæ•°,
    ROUND(AVG(age), 1) AS å¹³å‡å¹´é¾„
FROM students
WHERE age >= 18
GROUP BY gender
HAVING COUNT(*) > 1
ORDER BY å¹³å‡å¹´é¾„ DESC;

-- æ¡ˆä¾‹2ï¼šåˆ†é¡µæŸ¥è¯¢é‚®ç®±ä¸ä¸ºç©ºçš„å­¦ç”Ÿä¿¡æ¯
SELECT 
    name AS å§“å,
    age AS å¹´é¾„,
    gender AS æ€§åˆ«,
    email AS é‚®ç®±
FROM students
WHERE email IS NOT NULL AND email != ''
ORDER BY age ASC, name ASC
LIMIT 0, 10;

-- æ¡ˆä¾‹3ï¼šç»Ÿè®¡å„å¹´é¾„æ®µçš„å­¦ç”Ÿåˆ†å¸ƒ
SELECT 
    CASE 
        WHEN age < 18 THEN 'æœªæˆå¹´'
        WHEN age BETWEEN 18 AND 22 THEN '18-22å²'
        ELSE '23å²ä»¥ä¸Š'
    END AS å¹´é¾„æ®µ,
    COUNT(*) AS äººæ•°,
    ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM students), 2) AS å æ¯”ç™¾åˆ†æ¯”
FROM students
GROUP BY å¹´é¾„æ®µ
ORDER BY äººæ•° DESC;
```

## ğŸ’¡ 8. å®ç”¨æŠ€å·§ä¸æ³¨æ„äº‹é¡¹

### 8.1 æ€§èƒ½ä¼˜åŒ–å»ºè®®
```sql
-- é¿å… SELECT *ï¼Œåªé€‰æ‹©éœ€è¦çš„å­—æ®µ
SELECT name, age FROM students;  -- âœ… æ¨è
SELECT * FROM students;          -- âŒ ä¸æ¨è

-- ä¸ºç»å¸¸ç”¨äºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µåˆ›å»ºç´¢å¼•
CREATE INDEX idx_age ON students(age);
CREATE INDEX idx_gender_age ON students(gender, age);

-- ä½¿ç”¨ EXPLAIN åˆ†ææŸ¥è¯¢æ€§èƒ½
EXPLAIN SELECT * FROM students WHERE age > 20;
```

### 8.2 å¸¸è§é”™è¯¯é¿å…
```sql
-- é”™è¯¯ï¼šåœ¨ WHERE ä¸­ä½¿ç”¨èšåˆå‡½æ•°
SELECT gender, AVG(age) FROM students WHERE AVG(age) > 20;  -- âŒ é”™è¯¯
SELECT gender, AVG(age) FROM students HAVING AVG(age) > 20; -- âœ… æ­£ç¡®

-- é”™è¯¯ï¼šGROUP BY å­—æ®µä¸åœ¨ SELECT ä¸­
SELECT COUNT(*) FROM students GROUP BY gender;  -- âœ… å¯ä»¥
SELECT age, COUNT(*) FROM students GROUP BY gender;  -- âŒ é”™è¯¯

-- æ­£ç¡®ï¼šGROUP BY æ‰€æœ‰éèšåˆå­—æ®µ
SELECT gender, age, COUNT(*) FROM students GROUP BY gender, age;  -- âœ… æ­£ç¡®
```

---

**ğŸ“Œ ä¸‹ä¸€éƒ¨åˆ†é¢„å‘Š**ï¼šMySQL å‡½æ•°è¯¦è§£ï¼ˆå­—ç¬¦ä¸²å‡½æ•°ã€æ•°å­¦å‡½æ•°ã€æ—¥æœŸå‡½æ•°ç­‰ï¼‰

> ğŸš€ æŒæ¡äº† DQL æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œä½ å°±è·å¾—äº†ä»æ•°æ®åº“ä¸­ç²¾å‡†æå–ä¿¡æ¯çš„è¶…èƒ½åŠ›ï¼è®°å¾—å¤šç»ƒä¹ å„ç§æŸ¥è¯¢åœºæ™¯ï¼Œç†Ÿèƒ½ç”Ÿå·§å“¦ï½
