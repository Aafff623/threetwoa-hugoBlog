
# 🔍 MySQL DQL 数据查询语言

> 📖 **本文档内容基于**：[B站MySQL视频教程(0-57P)](https://www.bilibili.com/video/BV1Kr4y1i7ru/?spm_id_from=333.337.search-card.all.click&vd_source=7d8ded408b70aba5029782726fc72622) 和 [CSDN MySQL基础笔记](https://blog.csdn.net/wohuishidalao/article/details/133971522)

## 🎯 1. 基础查询语法

### 1.1 基本查询结构
```sql
-- 查询所有字段（实际开发中不建议使用*）
SELECT * FROM table_name;

-- 查询指定字段
SELECT column1, column2 FROM table_name;

-- 使用表名前缀
SELECT students.name, students.age FROM students;
```

### 1.2 别名与去重
```sql
-- 字段别名（AS 可省略）
SELECT name AS 姓名, age AS 年龄 FROM students;
SELECT name 姓名, age 年龄 FROM students;

-- 表别名
SELECT s.name, s.age FROM students s;

-- 去重查询
SELECT DISTINCT gender FROM students;
SELECT DISTINCT age, gender FROM students;  -- 多字段组合去重
```

## 🎯 2. 条件查询（WHERE）

### 2.1 比较运算符
```sql
-- 基本比较
SELECT * FROM students WHERE age > 20;
SELECT * FROM students WHERE age >= 18;
SELECT * FROM students WHERE age = 20;
SELECT * FROM students WHERE age <> 20;    -- 不等于
SELECT * FROM students WHERE age != 20;    -- 不等于
```

### 2.2 逻辑运算符
```sql
-- AND 运算符
SELECT * FROM students WHERE age > 18 AND gender = '女';

-- OR 运算符  
SELECT * FROM students WHERE age < 18 OR age > 22;

-- NOT 运算符
SELECT * FROM students WHERE NOT gender = '男';
SELECT * FROM students WHERE NOT age <= 20;

-- 组合使用
SELECT * FROM students 
WHERE (age > 18 AND gender = '女') OR (age < 20 AND gender = '男');
```

### 2.3 范围查询
```sql
-- BETWEEN AND（包含边界值）
SELECT * FROM students WHERE age BETWEEN 18 AND 22;

-- IN 运算符
SELECT * FROM students WHERE age IN (18, 20, 22);
SELECT * FROM students WHERE name IN ('张三', '李四', '王五');

-- NOT IN
SELECT * FROM students WHERE age NOT IN (18, 20);
```

### 2.4 模糊查询（LIKE）
```sql
-- % 通配符：匹配任意多个字符
SELECT * FROM students WHERE name LIKE '张%';   -- 张开头
SELECT * FROM students WHERE name LIKE '%明%';  -- 包含明
SELECT * FROM students WHERE name LIKE '%李';    -- 李结尾

-- _ 通配符：匹配单个字符
SELECT * FROM students WHERE name LIKE '李_';    -- 李开头，两个字
SELECT * FROM students WHERE name LIKE '_小_';   -- 中间为小，三个字

-- 转义特殊字符
SELECT * FROM students WHERE name LIKE '%\_%' ESCAPE '\';  -- 包含下划线
```

### 2.5 空值查询
```sql
-- 查询空值
SELECT * FROM students WHERE email IS NULL;
SELECT * FROM students WHERE email IS NULL OR email = '';

-- 查询非空值
SELECT * FROM students WHERE email IS NOT NULL;
SELECT * FROM students WHERE email IS NOT NULL AND email != '';
```

## 🎯 3. 排序与分页

### 3.1 排序查询（ORDER BY）
```sql
-- 单字段排序
SELECT * FROM students ORDER BY age DESC;  -- 降序
SELECT * FROM students ORDER BY age ASC;   -- 升序（默认）

-- 多字段排序
SELECT * FROM students 
ORDER BY gender ASC, age DESC;  -- 先按性别升序，同性别按年龄降序

-- 结合表达式排序
SELECT *, (score1 + score2) AS total_score 
FROM students 
ORDER BY total_score DESC;

-- NULL 值排序处理
SELECT * FROM students 
ORDER BY CASE WHEN email IS NULL THEN 1 ELSE 0 END, email;
```

### 3.2 分页查询（LIMIT）
```sql
-- 基本分页
SELECT * FROM students LIMIT 5;                    -- 前5条
SELECT * FROM students LIMIT 0, 5;                 -- 从0开始取5条
SELECT * FROM students LIMIT 5 OFFSET 0;           -- MySQL 8.0+ 语法

-- 分页公式：LIMIT (页码-1)*每页数量, 每页数量
SELECT * FROM students LIMIT 0, 10;                -- 第1页
SELECT * FROM students LIMIT 10, 10;               -- 第2页
SELECT * FROM students LIMIT 20, 10;               -- 第3页

-- 带条件的分页
SELECT * FROM students 
WHERE age > 18 
ORDER BY age DESC 
LIMIT 0, 5;
```

## 🎯 4. 聚合函数

### 4.1 常用聚合函数
```sql
-- 计数函数
SELECT COUNT(*) FROM students;                     -- 总记录数
SELECT COUNT(email) FROM students;                 -- 非空邮箱数
SELECT COUNT(DISTINCT gender) FROM students;       -- 不同性别数量

-- 极值函数
SELECT MAX(age) FROM students;                     -- 最大年龄
SELECT MIN(age) FROM students;                     -- 最小年龄

-- 求和与平均
SELECT SUM(age) FROM students;                     -- 年龄总和
SELECT AVG(age) FROM students;                     -- 平均年龄
SELECT ROUND(AVG(age), 2) FROM students;           -- 平均年龄（保留2位小数）
```

### 4.2 聚合函数组合使用
```sql
-- 多聚合函数组合
SELECT 
    COUNT(*) AS 总人数,
    AVG(age) AS 平均年龄,
    MAX(age) AS 最大年龄,
    MIN(age) AS 最小年龄
FROM students;

-- 带条件的聚合
SELECT 
    COUNT(*) AS 男生人数,
    AVG(age) AS 男生平均年龄
FROM students
WHERE gender = '男';
```

## 🎯 5. 分组查询（GROUP BY）

### 5.1 基本分组查询
```sql
-- 单字段分组
SELECT gender, COUNT(*) 
FROM students 
GROUP BY gender;

-- 多字段分组
SELECT gender, age, COUNT(*)
FROM students
GROUP BY gender, age;

-- 分组后排序
SELECT gender, COUNT(*) AS 人数
FROM students
GROUP BY gender
ORDER BY 人数 DESC;
```

### 5.2 HAVING 子句
```sql
-- HAVING 筛选分组结果
SELECT gender, COUNT(*) AS 人数
FROM students
GROUP BY gender
HAVING COUNT(*) > 2;

SELECT gender, AVG(age) AS 平均年龄
FROM students
GROUP BY gender
HAVING AVG(age) > 20;

-- HAVING 与 WHERE 的区别
SELECT gender, AVG(age) AS 平均年龄
FROM students
WHERE age > 18          -- 先过滤行
GROUP BY gender
HAVING AVG(age) > 20;   -- 再过滤组
```

## 🎯 6. 执行顺序详解

### 6.1 完整查询语句执行顺序
```mermaid
graph LR
A[FROM] --> B[WHERE] --> C[GROUP BY] --> D[HAVING] --> E[SELECT] --> F[ORDER BY] --> G[LIMIT]
```

### 6.2 执行顺序说明
1. **FROM**：确定数据来源的表
2. **WHERE**：过滤行数据
3. **GROUP BY**：对数据进行分组
4. **HAVING**：过滤分组结果
5. **SELECT**：选择显示的字段
6. **ORDER BY**：对结果进行排序
7. **LIMIT**：限制返回的行数

> 💡 **记忆技巧**：从哪来 → 过滤行 → 分组 → 过滤组 → 选择 → 排序 → 分页

## 🎯 7. 综合实战示例

### 7.1 复杂查询案例
```sql
-- 案例1：查询各性别18岁以上的学生人数和平均年龄
SELECT 
    gender AS 性别,
    COUNT(*) AS 人数,
    ROUND(AVG(age), 1) AS 平均年龄
FROM students
WHERE age >= 18
GROUP BY gender
HAVING COUNT(*) > 1
ORDER BY 平均年龄 DESC;

-- 案例2：分页查询邮箱不为空的学生信息
SELECT 
    name AS 姓名,
    age AS 年龄,
    gender AS 性别,
    email AS 邮箱
FROM students
WHERE email IS NOT NULL AND email != ''
ORDER BY age ASC, name ASC
LIMIT 0, 10;

-- 案例3：统计各年龄段的学生分布
SELECT 
    CASE 
        WHEN age < 18 THEN '未成年'
        WHEN age BETWEEN 18 AND 22 THEN '18-22岁'
        ELSE '23岁以上'
    END AS 年龄段,
    COUNT(*) AS 人数,
    ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM students), 2) AS 占比百分比
FROM students
GROUP BY 年龄段
ORDER BY 人数 DESC;
```

## 💡 8. 实用技巧与注意事项

### 8.1 性能优化建议
```sql
-- 避免 SELECT *，只选择需要的字段
SELECT name, age FROM students;  -- ✅ 推荐
SELECT * FROM students;          -- ❌ 不推荐

-- 为经常用于查询条件的字段创建索引
CREATE INDEX idx_age ON students(age);
CREATE INDEX idx_gender_age ON students(gender, age);

-- 使用 EXPLAIN 分析查询性能
EXPLAIN SELECT * FROM students WHERE age > 20;
```

### 8.2 常见错误避免
```sql
-- 错误：在 WHERE 中使用聚合函数
SELECT gender, AVG(age) FROM students WHERE AVG(age) > 20;  -- ❌ 错误
SELECT gender, AVG(age) FROM students HAVING AVG(age) > 20; -- ✅ 正确

-- 错误：GROUP BY 字段不在 SELECT 中
SELECT COUNT(*) FROM students GROUP BY gender;  -- ✅ 可以
SELECT age, COUNT(*) FROM students GROUP BY gender;  -- ❌ 错误

-- 正确：GROUP BY 所有非聚合字段
SELECT gender, age, COUNT(*) FROM students GROUP BY gender, age;  -- ✅ 正确
```

---

**📌 下一部分预告**：MySQL 函数详解（字符串函数、数学函数、日期函数等）

> 🚀 掌握了 DQL 数据查询语言，你就获得了从数据库中精准提取信息的超能力！记得多练习各种查询场景，熟能生巧哦～
