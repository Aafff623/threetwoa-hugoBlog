# ğŸ”— MySQL å¤šè¡¨æŸ¥è¯¢ä¸è¿æ¥æ“ä½œ
```mermaid
graph TD
A[MySQLå¤šè¡¨æŸ¥è¯¢] --> B[å†…è¿æ¥ INNER JOIN]
A --> C[å¤–è¿æ¥ OUTER JOIN]
A --> D[äº¤å‰è¿æ¥ CROSS JOIN]
A --> E[è‡ªè¿æ¥ SELF JOIN]
A --> F[è”åˆæŸ¥è¯¢ UNION]
A --> G[å­æŸ¥è¯¢ Subquery]

B --> B1[ç­‰å€¼è¿æ¥]
B --> B2[éç­‰å€¼è¿æ¥]
B --> B3[è‡ªç„¶è¿æ¥]

C --> C1[å·¦å¤–è¿æ¥ LEFT JOIN]
C --> C2[å³å¤–è¿æ¥ RIGHT JOIN]
C --> C3[å…¨å¤–è¿æ¥ FULL JOIN]

G --> G1[æ ‡é‡å­æŸ¥è¯¢]
G --> G2[åˆ—å­æŸ¥è¯¢]
G --> G3[è¡Œå­æŸ¥è¯¢]
G --> G4[è¡¨å­æŸ¥è¯¢]
G --> G5[ç›¸å…³å­æŸ¥è¯¢]
G --> G6[éç›¸å…³å­æŸ¥è¯¢]
```

---

## ğŸ¯ 1. è¿æ¥æŸ¥è¯¢åŸºç¡€

### 1.1 è¿æ¥æŸ¥è¯¢æ¦‚å¿µ
è¿æ¥æŸ¥è¯¢æ˜¯å°†å¤šä¸ªè¡¨ä¸­çš„æ•°æ®æŒ‰ç…§æŸç§æ¡ä»¶ç»„åˆåœ¨ä¸€èµ·çš„æ“ä½œï¼Œæ˜¯å…³ç³»å‹æ•°æ®åº“çš„æ ¸å¿ƒåŠŸèƒ½ã€‚

### 1.2 è¿æ¥ç±»å‹æ¦‚è¿°
```sql
-- å†…è¿æ¥ï¼šåªè¿”å›åŒ¹é…çš„è¡Œ
SELECT * FROM table1 INNER JOIN table2 ON condition;

-- å·¦å¤–è¿æ¥ï¼šè¿”å›å·¦è¡¨æ‰€æœ‰è¡Œï¼Œå³è¡¨åŒ¹é…çš„è¡Œ
SELECT * FROM table1 LEFT JOIN table2 ON condition;

-- å³å¤–è¿æ¥ï¼šè¿”å›å³è¡¨æ‰€æœ‰è¡Œï¼Œå·¦è¡¨åŒ¹é…çš„è¡Œ  
SELECT * FROM table1 RIGHT JOIN table2 ON condition;

-- å…¨å¤–è¿æ¥ï¼šè¿”å›å·¦å³è¡¨æ‰€æœ‰è¡Œï¼ˆMySQLä¸æ”¯æŒï¼Œç”¨UNIONæ¨¡æ‹Ÿï¼‰
SELECT * FROM table1 LEFT JOIN table2 ON condition
UNION
SELECT * FROM table1 RIGHT JOIN table2 ON condition;
```

## ğŸ¯ 2. å†…è¿æ¥ (INNER JOIN)

### 2.1 ç­‰å€¼è¿æ¥
```sql
-- åŸºæœ¬å†…è¿æ¥
SELECT employees.name, departments.dept_name
FROM employees
INNER JOIN departments ON employees.dept_id = departments.dept_id;

-- ä½¿ç”¨WHEREå­å¥çš„æ—§å¼å†™æ³•
SELECT employees.name, departments.dept_name
FROM employees, departments
WHERE employees.dept_id = departments.dept_id;

-- å¤šè¡¨å†…è¿æ¥
SELECT e.name, d.dept_name, p.project_name
FROM employees e
INNER JOIN departments d ON e.dept_id = d.dept_id
INNER JOIN projects p ON e.emp_id = p.manager_id;
```

### 2.2 éç­‰å€¼è¿æ¥
```sql
-- å·¥èµ„ç­‰çº§æŸ¥è¯¢
SELECT e.name, e.salary, g.grade_level
FROM employees e
INNER JOIN grade_levels g 
ON e.salary BETWEEN g.min_salary AND g.max_salary;

-- æ—¥æœŸèŒƒå›´è¿æ¥
SELECT o.order_id, c.campaign_name
FROM orders o
INNER JOIN campaigns c 
ON o.order_date BETWEEN c.start_date AND c.end_date;
```

### 2.3 è‡ªç„¶è¿æ¥ (NATURAL JOIN)
```sql
-- è‡ªåŠ¨åŒ¹é…ç›¸åŒåˆ—å
SELECT *
FROM employees
NATURAL JOIN departments;

-- ç­‰ä»·äº
SELECT *
FROM employees
INNER JOIN departments 
USING (dept_id);
```

## ğŸ¯ 3. å¤–è¿æ¥ (OUTER JOIN)

### 3.1 å·¦å¤–è¿æ¥ (LEFT JOIN)
```sql
-- æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥åŠå…¶éƒ¨é—¨ï¼ˆåŒ…æ‹¬æ— éƒ¨é—¨å‘˜å·¥ï¼‰
SELECT e.name, d.dept_name
FROM employees e
LEFT JOIN departments d ON e.dept_id = d.dept_id;

-- æŸ¥æ‰¾æ²¡æœ‰éƒ¨é—¨çš„å‘˜å·¥
SELECT e.name
FROM employees e
LEFT JOIN departments d ON e.dept_id = d.dept_id
WHERE d.dept_id IS NULL;

-- å¤šè¡¨å·¦è¿æ¥
SELECT e.name, d.dept_name, p.project_name
FROM employees e
LEFT JOIN departments d ON e.dept_id = d.dept_id
LEFT JOIN projects p ON e.emp_id = p.manager_id;
```

### 3.2 å³å¤–è¿æ¥ (RIGHT JOIN)
```sql
-- æŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨åŠå…¶å‘˜å·¥ï¼ˆåŒ…æ‹¬æ— å‘˜å·¥éƒ¨é—¨ï¼‰
SELECT d.dept_name, e.name
FROM employees e
RIGHT JOIN departments d ON e.dept_id = d.dept_id;

-- æŸ¥æ‰¾æ²¡æœ‰å‘˜å·¥çš„éƒ¨é—¨
SELECT d.dept_name
FROM employees e
RIGHT JOIN departments d ON e.dept_id = d.dept_id
WHERE e.emp_id IS NULL;
```

### 3.3 å…¨å¤–è¿æ¥æ¨¡æ‹Ÿ (FULL JOIN)
```sql
-- MySQLæ¨¡æ‹Ÿå…¨å¤–è¿æ¥
SELECT e.name, d.dept_name
FROM employees e
LEFT JOIN departments d ON e.dept_id = d.dept_id
UNION
SELECT e.name, d.dept_name
FROM employees e
RIGHT JOIN departments d ON e.dept_id = d.dept_id;
```

## ğŸ¯ 4. äº¤å‰è¿æ¥ (CROSS JOIN)

### 4.1 ç¬›å¡å°”ç§¯
```sql
-- æ˜¾å¼äº¤å‰è¿æ¥
SELECT e.name, d.dept_name
FROM employees e
CROSS JOIN departments d;

-- éšå¼äº¤å‰è¿æ¥ï¼ˆä¸æ¨èï¼‰
SELECT e.name, d.dept_name
FROM employees e, departments d;

-- å®é™…åº”ç”¨ï¼šç”Ÿæˆæµ‹è¯•æ•°æ®
SELECT p.product_name, s.size_name, c.color_name
FROM products p
CROSS JOIN sizes s
CROSS JOIN colors c;
```

## ğŸ¯ 5. è‡ªè¿æ¥ (SELF JOIN)

### 5.1 è‡ªè¿æ¥åº”ç”¨
```sql
-- å‘˜å·¥åŠå…¶ç»ç†å…³ç³»
SELECT e1.name AS employee_name, e2.name AS manager_name
FROM employees e1
LEFT JOIN employees e2 ON e1.manager_id = e2.emp_id;

-- æŸ¥æ‰¾åŒä¸€éƒ¨é—¨çš„å‘˜å·¥å¯¹
SELECT e1.name AS employee1, e2.name AS employee2
FROM employees e1
INNER JOIN employees e2 ON e1.dept_id = e2.dept_id
WHERE e1.emp_id < e2.emp_id;

-- å±‚çº§å…³ç³»æŸ¥è¯¢
SELECT e1.name, e2.name, e3.name
FROM employees e1
LEFT JOIN employees e2 ON e1.manager_id = e2.emp_id
LEFT JOIN employees e3 ON e2.manager_id = e3.emp_id;
```

## ğŸ¯ 6. è”åˆæŸ¥è¯¢ (UNION)

### 6.1 UNION æ“ä½œ
```sql
-- åˆå¹¶ä¸¤ä¸ªæŸ¥è¯¢ç»“æœï¼ˆå»é‡ï¼‰
SELECT name FROM current_employees
UNION
SELECT name FROM former_employees;

-- åˆå¹¶ç»“æœï¼ˆä¸å»é‡ï¼‰
SELECT name FROM current_employees
UNION ALL
SELECT name FROM former_employees;

-- å¤šè¡¨è”åˆæŸ¥è¯¢
SELECT 'Employee' AS type, name, hire_date AS date FROM employees
UNION ALL
SELECT 'Customer' AS type, cust_name, reg_date FROM customers
ORDER BY date DESC;
```

### 6.2 UNION ä½¿ç”¨è§„åˆ™
```sql
-- åˆ—æ•°å’Œç±»å‹å¿…é¡»åŒ¹é…
SELECT emp_id, name FROM employees
UNION
SELECT cust_id, cust_name FROM customers;

-- ä½¿ç”¨NULLå¡«å……ä¸åŒ¹é…çš„åˆ—
SELECT emp_id, name, NULL AS order_date FROM employees
UNION
SELECT NULL, cust_name, order_date FROM customers;
```

## ğŸ¯ 7. å­æŸ¥è¯¢ (Subquery)

### 7.1 æ ‡é‡å­æŸ¥è¯¢
```sql
-- è¿”å›å•ä¸ªå€¼çš„å­æŸ¥è¯¢
SELECT name, salary,
       (SELECT AVG(salary) FROM employees) AS avg_salary
FROM employees;

-- åœ¨WHEREä¸­ä½¿ç”¨
SELECT name, salary
FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);

-- åœ¨SELECTä¸­ä½¿ç”¨
SELECT dept_name,
       (SELECT COUNT(*) FROM employees e WHERE e.dept_id = d.dept_id) AS emp_count
FROM departments d;
```

### 7.2 åˆ—å­æŸ¥è¯¢
```sql
-- IN æ“ä½œç¬¦
SELECT name
FROM employees
WHERE dept_id IN (SELECT dept_id FROM departments WHERE location = 'åŒ—äº¬');

-- NOT IN æ“ä½œç¬¦
SELECT name
FROM employees
WHERE dept_id NOT IN (SELECT dept_id FROM departments WHERE budget < 100000);

-- ANY/SOME æ“ä½œç¬¦
SELECT name, salary
FROM employees
WHERE salary > ANY (SELECT salary FROM employees WHERE dept_id = 1);

-- ALL æ“ä½œç¬¦
SELECT name, salary
FROM employees
WHERE salary > ALL (SELECT salary FROM employees WHERE dept_id = 1);
```

### 7.3 è¡Œå­æŸ¥è¯¢
```sql
-- å¤šåˆ—æ¯”è¾ƒ
SELECT name, dept_id, salary
FROM employees
WHERE (dept_id, salary) IN (
    SELECT dept_id, MAX(salary)
    FROM employees
    GROUP BY dept_id
);

-- è¡Œæ„é€ å™¨æ¯”è¾ƒ
SELECT *
FROM employees
WHERE (dept_id, hire_date) = (1, '2023-01-01');
```

### 7.4 è¡¨å­æŸ¥è¯¢
```sql
-- FROMå­å¥ä¸­çš„å­æŸ¥è¯¢
SELECT dept_name, emp_count
FROM (
    SELECT d.dept_name, COUNT(e.emp_id) AS emp_count
    FROM departments d
    LEFT JOIN employees e ON d.dept_id = e.dept_id
    GROUP BY d.dept_id
) AS dept_stats
WHERE emp_count > 5;

-- ä½œä¸ºä¸´æ—¶è¡¨è¿æ¥
SELECT e.name, ds.avg_salary
FROM employees e
INNER JOIN (
    SELECT dept_id, AVG(salary) AS avg_salary
    FROM employees
    GROUP BY dept_id
) AS ds ON e.dept_id = ds.dept_id;
```

### 7.5 ç›¸å…³å­æŸ¥è¯¢
```sql
--  EXISTS æ“ä½œç¬¦
SELECT dept_name
FROM departments d
WHERE EXISTS (
    SELECT 1
    FROM employees e
    WHERE e.dept_id = d.dept_id AND e.salary > 50000
);

-- NOT EXISTS æ“ä½œç¬¦
SELECT dept_name
FROM departments d
WHERE NOT EXISTS (
    SELECT 1
    FROM employees e
    WHERE e.dept_id = d.dept_id
);

-- ç›¸å…³æ›´æ–°
UPDATE employees e
SET salary = salary * 1.1
WHERE salary < (SELECT AVG(salary) FROM employees WHERE dept_id = e.dept_id);
```

## ğŸ¯ 8. è¿æ¥æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–

### 8.1 ç´¢å¼•ä¼˜åŒ–
```sql
-- ä¸ºè¿æ¥å­—æ®µåˆ›å»ºç´¢å¼•
CREATE INDEX idx_dept_id ON employees(dept_id);
CREATE INDEX idx_emp_id ON projects(manager_id);

-- è¦†ç›–ç´¢å¼•
CREATE INDEX idx_emp_dept_salary ON employees(dept_id, salary);
```

### 8.2 æŸ¥è¯¢ä¼˜åŒ–æŠ€å·§
```sql
-- ä½¿ç”¨EXISTSä»£æ›¿IN
SELECT dept_name
FROM departments d
WHERE EXISTS (
    SELECT 1 FROM employees e WHERE e.dept_id = d.dept_id
);

-- é¿å…åœ¨è¿æ¥æ¡ä»¶ä¸­ä½¿ç”¨å‡½æ•°
SELECT * 
FROM employees e
INNER JOIN departments d ON e.dept_id = d.dept_id  -- âœ… å¥½
WHERE YEAR(e.hire_date) = 2023;                    -- âŒ ä¸å¥½

-- ä½¿ç”¨LIMITé™åˆ¶ç»“æœé›†
SELECT e.name, d.dept_name
FROM employees e
INNER JOIN departments d ON e.dept_id = d.dept_id
LIMIT 100;
```

### 8.3 æ‰§è¡Œè®¡åˆ’åˆ†æ
```sql
-- æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’
EXPLAIN 
SELECT e.name, d.dept_name
FROM employees e
INNER JOIN departments d ON e.dept_id = d.dept_id;

-- åˆ†æè¿æ¥æ€§èƒ½
EXPLAIN ANALYZE
SELECT e.name, d.dept_name
FROM employees e
LEFT JOIN departments d ON e.dept_id = d.dept_id;
```

## ğŸ¯ 9. å®æˆ˜ç»¼åˆæ¡ˆä¾‹

### 9.1 å¤æ‚ä¸šåŠ¡æŸ¥è¯¢
```sql
-- æŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥
SELECT d.dept_name, e.name, e.salary
FROM employees e
INNER JOIN departments d ON e.dept_id = d.dept_id
INNER JOIN (
    SELECT dept_id, MAX(salary) AS max_salary
    FROM employees
    GROUP BY dept_id
) AS max_sal ON e.dept_id = max_sal.dept_id AND e.salary = max_sal.max_salary;

-- æŸ¥è¯¢æ²¡æœ‰é¡¹ç›®çš„å‘˜å·¥
SELECT e.name, d.dept_name
FROM employees e
LEFT JOIN departments d ON e.dept_id = d.dept_id
WHERE NOT EXISTS (
    SELECT 1 FROM projects p WHERE p.manager_id = e.emp_id
);

-- å±‚çº§ç»„ç»‡æ¶æ„æŸ¥è¯¢
WITH RECURSIVE org_chart AS (
    -- é”šç‚¹æŸ¥è¯¢ï¼šé¡¶çº§ç®¡ç†è€…
    SELECT emp_id, name, manager_id, 1 AS level
    FROM employees
    WHERE manager_id IS NULL
    
    UNION ALL
    
    -- é€’å½’æŸ¥è¯¢ï¼šä¸‹å±å‘˜å·¥
    SELECT e.emp_id, e.name, e.manager_id, oc.level + 1
    FROM employees e
    INNER JOIN org_chart oc ON e.manager_id = oc.emp_id
)
SELECT * FROM org_chart ORDER BY level, name;
```

### 9.2 æŠ¥è¡¨ç»Ÿè®¡æŸ¥è¯¢
```sql
-- éƒ¨é—¨ç»Ÿè®¡æŠ¥è¡¨
SELECT 
    d.dept_name,
    COUNT(e.emp_id) AS total_employees,
    AVG(e.salary) AS avg_salary,
    MAX(e.salary) AS max_salary,
    MIN(e.salary) AS min_salary,
    SUM(CASE WHEN e.hire_date >= '2023-01-01' THEN 1 ELSE 0 END) AS new_hires
FROM departments d
LEFT JOIN employees e ON d.dept_id = e.dept_id
GROUP BY d.dept_id
ORDER BY total_employees DESC;

-- å‘˜å·¥é¡¹ç›®å‚ä¸æƒ…å†µ
SELECT 
    e.name,
    d.dept_name,
    COUNT(p.project_id) AS project_count,
    GROUP_CONCAT(p.project_name) AS projects
FROM employees e
LEFT JOIN departments d ON e.dept_id = d.dept_id
LEFT JOIN project_members pm ON e.emp_id = pm.emp_id
LEFT JOIN projects p ON pm.project_id = p.project_id
GROUP BY e.emp_id
HAVING project_count > 0;
```

## ğŸ’¡ 10. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 10.1 æ€§èƒ½é—®é¢˜å¤„ç†
```sql
-- å¤§è¡¨è¿æ¥ä¼˜åŒ–ï¼šåˆ†æ®µå¤„ç†
SELECT * 
FROM large_table1 l1
INNER JOIN large_table2 l2 ON l1.id = l2.id
WHERE l1.create_date >= '2023-01-01'
LIMIT 1000;

-- ä½¿ç”¨ä¸´æ—¶è¡¨ä¼˜åŒ–å¤æ‚æŸ¥è¯¢
CREATE TEMPORARY TABLE temp_dept_stats AS
SELECT dept_id, COUNT(*) AS emp_count, AVG(salary) AS avg_salary
FROM employees
GROUP BY dept_id;

SELECT d.dept_name, t.emp_count, t.avg_salary
FROM departments d
INNER JOIN temp_dept_stats t ON d.dept_id = t.dept_id;
```

### 10.2 æ•°æ®ä¸€è‡´æ€§é—®é¢˜
```sql
-- æ£€æŸ¥è¿æ¥å®Œæ•´æ€§
SELECT e.emp_id, e.name, e.dept_id
FROM employees e
LEFT JOIN departments d ON e.dept_id = d.dept_id
WHERE d.dept_id IS NULL AND e.dept_id IS NOT NULL;

-- ä¿®å¤æ•°æ®ä¸ä¸€è‡´
UPDATE employees e
SET dept_id = NULL
WHERE NOT EXISTS (
    SELECT 1 FROM departments d WHERE d.dept_id = e.dept_id
) AND e.dept_id IS NOT NULL;
```

> ğŸš€ å¤šè¡¨æŸ¥è¯¢æ˜¯SQLçš„æ ¸å¿ƒæŠ€èƒ½ï¼ŒæŒæ¡å„ç§è¿æ¥æ–¹å¼å’Œå­æŸ¥è¯¢æŠ€å·§ï¼Œèƒ½å¤Ÿè®©ä½ è½»æ¾å¤„ç†å¤æ‚çš„æ•°æ®å…³ç³»ï¼è®°å¾—å¤šç»ƒä¹ å®é™…ä¸šåŠ¡åœºæ™¯ï¼Œç†Ÿèƒ½ç”Ÿå·§ï½

