# ğŸª Java æ³¨è§£ä¸åå°„

## ä¸€ã€æ³¨è§£ï¼ˆAnnotationï¼‰

### 1.1 æ³¨è§£æ¦‚è¿°

> ğŸ’¡ æ³¨è§£æ˜¯ JDK5.0 å¼•å…¥çš„å…ƒæ•°æ®æœºåˆ¶ï¼Œç”¨äºä¸ºä»£ç æ·»åŠ é¢å¤–ä¿¡æ¯

**æ³¨è§£ vs æ³¨é‡Š**ï¼š
- æ³¨é‡Šï¼šç»™äººçœ‹çš„ï¼Œç¼–è¯‘å™¨ä¼šå¿½ç•¥
- æ³¨è§£ï¼šç»™ç¼–è¯‘å™¨å’Œå…¶ä»–å·¥å…·çœ‹çš„ï¼Œå¯ä»¥è¢«è¯»å–å’Œå¤„ç†

### 1.2 å†…ç½®æ³¨è§£

```java
// @Override - æ£€æŸ¥æ–¹æ³•é‡å†™
@Override
public String toString() {
    return super.toString();
}

// @Deprecated - æ ‡è®°è¿‡æ—¶æ–¹æ³•
@Deprecated
public static void oldMethod() {
    System.out.println("è¿‡æ—¶æ–¹æ³•");
}

// @SuppressWarnings - æŠ‘åˆ¶è­¦å‘Š
@SuppressWarnings({"unchecked", "deprecation"})
public void test() {
    List list = new ArrayList(); // ä¸ä¼šäº§ç”Ÿè­¦å‘Š
}
```

### 1.3 å…ƒæ³¨è§£ï¼ˆMeta-Annotationï¼‰

```java
@Target(ElementType.METHOD) // æ³¨è§£ä½¿ç”¨èŒƒå›´ï¼šæ–¹æ³•
@Retention(RetentionPolicy.RUNTIME) // æ³¨è§£ç”Ÿå‘½å‘¨æœŸï¼šè¿è¡Œæ—¶
@Documented // åŒ…å«åœ¨Javadocä¸­
@Inherited // å…è®¸å­ç±»ç»§æ‰¿
public @interface MyAnnotation {
    String value() default "";
}
```

### 1.4 è‡ªå®šä¹‰æ³¨è§£

```java
// å®šä¹‰æ³¨è§£
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface Table {
    String value(); // è¡¨å
}

@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Column {
    String name(); // åˆ—å
    String type(); // ç±»å‹
    int length() default 255; // é•¿åº¦
}

// ä½¿ç”¨æ³¨è§£
@Table("user")
public class User {
    @Column(name = "id", type = "int")
    private int id;
    
    @Column(name = "name", type = "varchar", length = 50)
    private String name;
}
```

---

## äºŒã€åå°„ï¼ˆReflectionï¼‰

### 2.1 åå°„æ¦‚è¿°

> ğŸ” åå°„å…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶è·å–ç±»çš„å®Œæ•´ä¿¡æ¯å¹¶åŠ¨æ€æ“ä½œå¯¹è±¡

**åå°„æ ¸å¿ƒç±»**ï¼š
- `Class` - ç±»çš„å…ƒæ•°æ®
- `Field` - ç±»çš„å­—æ®µ
- `Method` - ç±»çš„æ–¹æ³•  
- `Constructor` - ç±»çš„æ„é€ å™¨

### 2.2 è·å– Class å¯¹è±¡çš„å››ç§æ–¹å¼

```java
// 1. é€šè¿‡ç±»å.class
Class<String> clazz1 = String.class;

// 2. é€šè¿‡å¯¹è±¡.getClass()
String str = "hello";
Class<?> clazz2 = str.getClass();

// 3. é€šè¿‡Class.forName()
Class<?> clazz3 = Class.forName("java.lang.String");

// 4. åŸºæœ¬æ•°æ®ç±»å‹çš„TYPE
Class<Integer> clazz4 = int.TYPE;
```

### 2.3 åå°„æ“ä½œç±»æˆå‘˜

```java
public class ReflectionDemo {
    public static void main(String[] args) throws Exception {
        Class<?> clazz = Class.forName("com.example.User");
        
        // è·å–æ‰€æœ‰å­—æ®µï¼ˆåŒ…æ‹¬ç§æœ‰ï¼‰
        Field[] fields = clazz.getDeclaredFields();
        for (Field field : fields) {
            field.setAccessible(true); // è®¾ç½®å¯è®¿é—®ç§æœ‰å­—æ®µ
            System.out.println("å­—æ®µ: " + field.getName());
        }
        
        // è·å–æ‰€æœ‰æ–¹æ³•
        Method[] methods = clazz.getDeclaredMethods();
        for (Method method : methods) {
            System.out.println("æ–¹æ³•: " + method.getName());
        }
        
        // åˆ›å»ºå®ä¾‹
        Object instance = clazz.newInstance();
        
        // è°ƒç”¨æ–¹æ³•
        Method setNameMethod = clazz.getMethod("setName", String.class);
        setNameMethod.invoke(instance, "å¼ ä¸‰");
        
        Method getNameMethod = clazz.getMethod("getName");
        String name = (String) getNameMethod.invoke(instance);
        System.out.println("å§“å: " + name);
    }
}
```

### 2.4 åå°„æ“ä½œæ³›å‹

```java
public class GenericDemo {
    public List<String> stringList;
    
    public static void main(String[] args) throws Exception {
        Field field = GenericDemo.class.getField("stringList");
        Type genericType = field.getGenericType();
        
        if (genericType instanceof ParameterizedType) {
            ParameterizedType pt = (ParameterizedType) genericType;
            Type[] actualTypes = pt.getActualTypeArguments();
            System.out.println("æ³›å‹ç±»å‹: " + actualTypes[0]); // class java.lang.String
        }
    }
}
```

---

## ä¸‰ã€æ³¨è§£ + åå°„å®æˆ˜ï¼šORMæ¡†æ¶

### 3.1 å®šä¹‰ORMæ³¨è§£

```java
// è¡¨æ³¨è§£
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface DBTable {
    String name();
}

// åˆ—æ³¨è§£
@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
public @interface DBColumn {
    String name();
    String type();
    boolean nullable() default true;
}
```

### 3.2 å®ä½“ç±»å®šä¹‰

```java
@DBTable(name = "users")
public class User {
    @DBColumn(name = "id", type = "INT", nullable = false)
    private Integer id;
    
    @DBColumn(name = "username", type = "VARCHAR(50)")
    private String username;
    
    @DBColumn(name = "email", type = "VARCHAR(100)")
    private String email;
    
    // æ„é€ æ–¹æ³•ã€getterã€setterçœç•¥
}
```

### 3.3 ORMæ˜ å°„å·¥å…·

```java
public class ORMUtil {
    public static String generateCreateTableSQL(Class<?> clazz) {
        if (!clazz.isAnnotationPresent(DBTable.class)) {
            throw new RuntimeException("ç±»æ²¡æœ‰@DBTableæ³¨è§£");
        }
        
        DBTable table = clazz.getAnnotation(DBTable.class);
        StringBuilder sql = new StringBuilder();
        sql.append("CREATE TABLE ").append(table.name()).append(" (\n");
        
        Field[] fields = clazz.getDeclaredFields();
        for (int i = 0; i < fields.length; i++) {
            Field field = fields[i];
            if (field.isAnnotationPresent(DBColumn.class)) {
                DBColumn column = field.getAnnotation(DBColumn.class);
                sql.append("  ").append(column.name()).append(" ").append(column.type());
                if (!column.nullable()) {
                    sql.append(" NOT NULL");
                }
                if (i < fields.length - 1) {
                    sql.append(",");
                }
                sql.append("\n");
            }
        }
        sql.append(");");
        return sql.toString();
    }
    
    public static void main(String[] args) {
        String sql = generateCreateTableSQL(User.class);
        System.out.println(sql);
    }
}
```

**è¾“å‡ºç»“æœ**ï¼š
```sql
CREATE TABLE users (
  id INT NOT NULL,
  username VARCHAR(50),
  email VARCHAR(100)
);
```

---

## å››ã€åå°„æ€§èƒ½ä¼˜åŒ–

### 4.1 ç¼“å­˜åå°„å¯¹è±¡

```java
public class ReflectionCache {
    private static final Map<Class<?>, Map<String, Field>> fieldCache = new ConcurrentHashMap<>();
    private static final Map<Class<?>, Map<String, Method>> methodCache = new ConcurrentHashMap<>();
    
    public static Field getField(Class<?> clazz, String fieldName) throws NoSuchFieldException {
        Map<String, Field> fields = fieldCache.computeIfAbsent(clazz, k -> new ConcurrentHashMap<>());
        return fields.computeIfAbsent(fieldName, name -> {
            try {
                Field field = clazz.getDeclaredField(name);
                field.setAccessible(true);
                return field;
            } catch (NoSuchFieldException e) {
                throw new RuntimeException(e);
            }
        });
    }
    
    public static Object getFieldValue(Object obj, String fieldName) throws Exception {
        Field field = getField(obj.getClass(), fieldName);
        return field.get(obj);
    }
}
```

### 4.2 ä½¿ç”¨ setAccessible æå‡æ€§èƒ½

```java
public class PerformanceDemo {
    public static void main(String[] args) throws Exception {
        Class<?> clazz = User.class;
        User user = new User();
        Field field = clazz.getDeclaredField("username");
        
        // ç¦ç”¨è®¿é—®æ£€æŸ¥ï¼ˆå¤§å¹…æå‡æ€§èƒ½ï¼‰
        field.setAccessible(true);
        
        long start = System.currentTimeMillis();
        for (int i = 0; i < 1000000; i++) {
            field.set(user, "test" + i);
        }
        long end = System.currentTimeMillis();
        System.out.println("è€—æ—¶: " + (end - start) + "ms");
    }
}
```

---

## äº”ã€æ€»ç»“å¯¹æ¯”

### 5.1 æ³¨è§£ç±»å‹æ€»ç»“

| æ³¨è§£ç±»å‹ | ä½œç”¨ | ç¤ºä¾‹ |
|---------|------|------|
| å†…ç½®æ³¨è§£ | Javaè‡ªå¸¦ | `@Override`, `@Deprecated` |
| å…ƒæ³¨è§£ | æ³¨è§£å…¶ä»–æ³¨è§£ | `@Target`, `@Retention` |
| è‡ªå®šä¹‰æ³¨è§£ | ç”¨æˆ·è‡ªå®šä¹‰ | `@DBTable`, `@DBColumn` |

### 5.2 åå°„åº”ç”¨åœºæ™¯

| åœºæ™¯ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| æ¡†æ¶å¼€å‘ | å®ç°IoCã€AOPç­‰ | Springæ¡†æ¶ |
| åŠ¨æ€ä»£ç† | è¿è¡Œæ—¶ç”Ÿæˆä»£ç†ç±» | JDKåŠ¨æ€ä»£ç† |
| åºåˆ—åŒ– | å¯¹è±¡ä¸æ•°æ®è½¬æ¢ | Jackson, Gson |
| ORMæ˜ å°„ | å¯¹è±¡å…³ç³»æ˜ å°„ | Hibernate, MyBatis |
| å•å…ƒæµ‹è¯• | åŠ¨æ€è°ƒç”¨æµ‹è¯•æ–¹æ³• | JUnit |

### 5.3 æ€§èƒ½è€ƒè™‘

| æ“ä½œ | æ€§èƒ½å½±å“ | å»ºè®® |
|------|---------|------|
| è·å–Classå¯¹è±¡ | ä½ | å¯ç¼“å­˜ |
| è·å–Field/Method | ä¸­ | å¯ç¼“å­˜ |
| è°ƒç”¨setAccessible | ä¸€æ¬¡æ€§å¼€é”€ | å¿…è¦æ—¶åº”ä½¿ç”¨ |
| æ–¹æ³•è°ƒç”¨(invoke) | é«˜ | é¿å…é¢‘ç¹è°ƒç”¨ |

> ğŸš€ **æœ€ä½³å®è·µ**ï¼šåå°„è™½å¼ºå¤§ä½†åº”è°¨æ…ä½¿ç”¨ï¼Œä¼˜å…ˆè€ƒè™‘æ¥å£å’ŒæŠ½è±¡ç±»ç­‰é¢å‘å¯¹è±¡çš„è®¾è®¡æ–¹å¼ã€‚åœ¨å¿…é¡»ä½¿ç”¨åå°„æ—¶ï¼Œæ³¨æ„ç¼“å­˜åå°„å¯¹è±¡å’Œåˆç†ä½¿ç”¨ `setAccessible(true)` æ¥æå‡æ€§èƒ½ã€‚

---

é€šè¿‡æ³¨è§£å’Œåå°„ï¼ŒJava å®ç°äº†å¼ºå¤§çš„å…ƒç¼–ç¨‹èƒ½åŠ›ï¼Œè¿™æ˜¯å¾ˆå¤šæ¡†æ¶å’Œåº“çš„åŸºç¡€ã€‚æŒæ¡è¿™ä¸¤é¡¹æŠ€æœ¯ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°ç†è§£ Java ç”Ÿæ€ç³»ç»Ÿçš„è¿è¡Œæœºåˆ¶ï¼Œä¹Ÿæ˜¯è¿›é˜¶é«˜çº§å¼€å‘çš„å¿…å¤‡æŠ€èƒ½ã€‚